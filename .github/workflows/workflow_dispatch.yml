name: Repository Dispatch Workflow
run-name: Run for ${{ github.event.client_payload.project }}  ${{ github.event.client_payload.version }} ${{ github.event.client_payload.build }} ${{ github.event.client_payload.buildversion }} 
on:
  workflow_dispatch:
    inputs: 
      json_input:
        type: string
env:
  parametersJson: ${{ toJson(github.event.client_payload) }}
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout gew√ºnschten Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.client_payload.ref }}

      - name: Zeige Payload-Daten
        run: |
          echo "Branch: ${{ github.event.client_payload.ref }}"
          echo "Environment: ${{ github.event.client_payload.environment }}"
          echo "Version: ${{ github.event.client_payload.version }}"
          echo "Features: ${{ join(github.event.client_payload.features, ', ') }}"
          echo "Build ID: ${{ github.event.client_payload.metadata.build_id }}"
          echo "Timestamp: ${{ github.event.client_payload.metadata.timestamp }}"
          echo "Type: ${{ github.event.client_payload.delivery_type }}"
          echo "Eements : ${{ github.event.client_payload.Elements.DropLocation }}"
      - name: Print Env from payload
        run: |
          echo " Write variable from parameter_json "
          echo $parametersJson | jq
      - name: Trigger Second Workflow
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          event-type: trigger-second
          client-payload: |
            {
              "ref": "${{ github.event.client_payload.ref }}",
              "environment": "${{ github.event.client_payload.environment }}",
              "version": "${{ github.event.client_payload.version }}",
              "message": "Triggered from first workflow",
              "original_payload": ${{ toJson(github.event.client_payload) }}
            }
  call-workflow-test:
    needs: build
    uses: ./.github/workflows/called-workflow.yml
    with: 
      my_input: "Earth"